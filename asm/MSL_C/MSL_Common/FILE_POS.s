.include "macros.inc"

.section .text, "ax"

glabel _ftell
/* 80161F9C 0015D4BC  80 03 00 04 */	lwz r0, 4(r3)
/* 80161FA0 0015D4C0  38 C0 00 00 */	li r6, 0
/* 80161FA4 0015D4C4  54 04 57 7E */	rlwinm r4, r0, 0xa, 0x1d, 0x1f
/* 80161FA8 0015D4C8  38 04 00 FF */	addi r0, r4, 0xff
/* 80161FAC 0015D4CC  54 00 06 3E */	clrlwi r0, r0, 0x18
/* 80161FB0 0015D4D0  28 00 00 01 */	cmplwi r0, 1
/* 80161FB4 0015D4D4  41 81 00 10 */	bgt lbl_80161FC4
/* 80161FB8 0015D4D8  88 03 00 0A */	lbz r0, 0xa(r3)
/* 80161FBC 0015D4DC  2C 00 00 00 */	cmpwi r0, 0
/* 80161FC0 0015D4E0  41 82 00 14 */	beq lbl_80161FD4
lbl_80161FC4:
/* 80161FC4 0015D4E4  38 00 00 28 */	li r0, 0x28
/* 80161FC8 0015D4E8  38 60 FF FF */	li r3, -1
/* 80161FCC 0015D4EC  90 0D 93 40 */	stw r0, lbl_802477C0@sda21(r13)
/* 80161FD0 0015D4F0  4E 80 00 20 */	blr 
lbl_80161FD4:
/* 80161FD4 0015D4F4  80 03 00 08 */	lwz r0, 8(r3)
/* 80161FD8 0015D4F8  54 05 1F 7F */	rlwinm. r5, r0, 3, 0x1d, 0x1f
/* 80161FDC 0015D4FC  40 82 00 0C */	bne lbl_80161FE8
/* 80161FE0 0015D500  80 63 00 18 */	lwz r3, 0x18(r3)
/* 80161FE4 0015D504  4E 80 00 20 */	blr 
lbl_80161FE8:
/* 80161FE8 0015D508  81 03 00 1C */	lwz r8, 0x1c(r3)
/* 80161FEC 0015D50C  28 05 00 03 */	cmplwi r5, 3
/* 80161FF0 0015D510  80 83 00 24 */	lwz r4, 0x24(r3)
/* 80161FF4 0015D514  80 03 00 34 */	lwz r0, 0x34(r3)
/* 80161FF8 0015D518  7C 88 20 50 */	subf r4, r8, r4
/* 80161FFC 0015D51C  7C E0 22 14 */	add r7, r0, r4
/* 80162000 0015D520  41 80 00 0C */	blt lbl_8016200C
/* 80162004 0015D524  38 C5 FF FE */	addi r6, r5, -2
/* 80162008 0015D528  7C E6 38 50 */	subf r7, r6, r7
lbl_8016200C:
/* 8016200C 0015D52C  80 03 00 04 */	lwz r0, 4(r3)
/* 80162010 0015D530  54 00 6F FF */	rlwinm. r0, r0, 0xd, 0x1f, 0x1f
/* 80162014 0015D534  40 82 00 28 */	bne lbl_8016203C
/* 80162018 0015D538  7C 06 20 51 */	subf. r0, r6, r4
/* 8016201C 0015D53C  7C 09 03 A6 */	mtctr r0
/* 80162020 0015D540  41 82 00 1C */	beq lbl_8016203C
lbl_80162024:
/* 80162024 0015D544  88 08 00 00 */	lbz r0, 0(r8)
/* 80162028 0015D548  39 08 00 01 */	addi r8, r8, 1
/* 8016202C 0015D54C  28 00 00 0A */	cmplwi r0, 0xa
/* 80162030 0015D550  40 82 00 08 */	bne lbl_80162038
/* 80162034 0015D554  38 E7 00 01 */	addi r7, r7, 1
lbl_80162038:
/* 80162038 0015D558  42 00 FF EC */	bdnz lbl_80162024
lbl_8016203C:
/* 8016203C 0015D55C  7C E3 3B 78 */	mr r3, r7
/* 80162040 0015D560  4E 80 00 20 */	blr 

glabel ftell
/* 80162044 0015D564  4B FF FF 58 */	b _ftell

glabel _fseek
/* 80162048 0015D568  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 8016204C 0015D56C  7C 08 02 A6 */	mflr r0
/* 80162050 0015D570  90 01 00 24 */	stw r0, 0x24(r1)
/* 80162054 0015D574  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 80162058 0015D578  7C BF 2B 78 */	mr r31, r5
/* 8016205C 0015D57C  93 C1 00 18 */	stw r30, 0x18(r1)
/* 80162060 0015D580  7C 7E 1B 78 */	mr r30, r3
/* 80162064 0015D584  90 81 00 08 */	stw r4, 8(r1)
/* 80162068 0015D588  80 03 00 04 */	lwz r0, 4(r3)
/* 8016206C 0015D58C  54 00 57 7E */	rlwinm r0, r0, 0xa, 0x1d, 0x1f
/* 80162070 0015D590  28 00 00 01 */	cmplwi r0, 1
/* 80162074 0015D594  40 82 00 10 */	bne lbl_80162084
/* 80162078 0015D598  88 03 00 0A */	lbz r0, 0xa(r3)
/* 8016207C 0015D59C  2C 00 00 00 */	cmpwi r0, 0
/* 80162080 0015D5A0  41 82 00 14 */	beq lbl_80162094
lbl_80162084:
/* 80162084 0015D5A4  38 00 00 28 */	li r0, 0x28
/* 80162088 0015D5A8  38 60 FF FF */	li r3, -1
/* 8016208C 0015D5AC  90 0D 93 40 */	stw r0, lbl_802477C0@sda21(r13)
/* 80162090 0015D5B0  48 00 01 64 */	b lbl_801621F4
lbl_80162094:
/* 80162094 0015D5B4  80 03 00 08 */	lwz r0, 8(r3)
/* 80162098 0015D5B8  54 00 1F 7E */	srwi r0, r0, 0x1d
/* 8016209C 0015D5BC  28 00 00 01 */	cmplwi r0, 1
/* 801620A0 0015D5C0  40 82 00 34 */	bne lbl_801620D4
/* 801620A4 0015D5C4  38 80 00 00 */	li r4, 0
/* 801620A8 0015D5C8  4B FF F7 95 */	bl __flush_buffer
/* 801620AC 0015D5CC  2C 03 00 00 */	cmpwi r3, 0
/* 801620B0 0015D5D0  41 82 00 24 */	beq lbl_801620D4
/* 801620B4 0015D5D4  38 00 00 01 */	li r0, 1
/* 801620B8 0015D5D8  38 80 00 00 */	li r4, 0
/* 801620BC 0015D5DC  98 1E 00 0A */	stb r0, 0xa(r30)
/* 801620C0 0015D5E0  38 00 00 28 */	li r0, 0x28
/* 801620C4 0015D5E4  38 60 FF FF */	li r3, -1
/* 801620C8 0015D5E8  90 9E 00 28 */	stw r4, 0x28(r30)
/* 801620CC 0015D5EC  90 0D 93 40 */	stw r0, lbl_802477C0@sda21(r13)
/* 801620D0 0015D5F0  48 00 01 24 */	b lbl_801621F4
lbl_801620D4:
/* 801620D4 0015D5F4  2C 1F 00 01 */	cmpwi r31, 1
/* 801620D8 0015D5F8  40 82 00 1C */	bne lbl_801620F4
/* 801620DC 0015D5FC  7F C3 F3 78 */	mr r3, r30
/* 801620E0 0015D600  3B E0 00 00 */	li r31, 0
/* 801620E4 0015D604  4B FF FE B9 */	bl _ftell
/* 801620E8 0015D608  80 01 00 08 */	lwz r0, 8(r1)
/* 801620EC 0015D60C  7C 00 1A 14 */	add r0, r0, r3
/* 801620F0 0015D610  90 01 00 08 */	stw r0, 8(r1)
lbl_801620F4:
/* 801620F4 0015D614  2C 1F 00 02 */	cmpwi r31, 2
/* 801620F8 0015D618  41 82 00 80 */	beq lbl_80162178
/* 801620FC 0015D61C  80 1E 00 04 */	lwz r0, 4(r30)
/* 80162100 0015D620  54 00 2F 7E */	rlwinm r0, r0, 5, 0x1d, 0x1f
/* 80162104 0015D624  28 00 00 03 */	cmplwi r0, 3
/* 80162108 0015D628  41 82 00 70 */	beq lbl_80162178
/* 8016210C 0015D62C  80 DE 00 08 */	lwz r6, 8(r30)
/* 80162110 0015D630  54 C3 1F 7E */	srwi r3, r6, 0x1d
/* 80162114 0015D634  38 03 FF FE */	addi r0, r3, -2
/* 80162118 0015D638  28 00 00 01 */	cmplwi r0, 1
/* 8016211C 0015D63C  41 81 00 5C */	bgt lbl_80162178
/* 80162120 0015D640  80 61 00 08 */	lwz r3, 8(r1)
/* 80162124 0015D644  80 BE 00 18 */	lwz r5, 0x18(r30)
/* 80162128 0015D648  7C 03 28 40 */	cmplw r3, r5
/* 8016212C 0015D64C  40 80 00 10 */	bge lbl_8016213C
/* 80162130 0015D650  80 1E 00 34 */	lwz r0, 0x34(r30)
/* 80162134 0015D654  7C 03 00 40 */	cmplw r3, r0
/* 80162138 0015D658  40 80 00 14 */	bge lbl_8016214C
lbl_8016213C:
/* 8016213C 0015D65C  80 1E 00 08 */	lwz r0, 8(r30)
/* 80162140 0015D660  54 00 00 FE */	clrlwi r0, r0, 3
/* 80162144 0015D664  90 1E 00 08 */	stw r0, 8(r30)
/* 80162148 0015D668  48 00 00 3C */	b lbl_80162184
lbl_8016214C:
/* 8016214C 0015D66C  80 9E 00 1C */	lwz r4, 0x1c(r30)
/* 80162150 0015D670  7C 60 18 50 */	subf r3, r0, r3
/* 80162154 0015D674  38 00 00 02 */	li r0, 2
/* 80162158 0015D678  7C 64 1A 14 */	add r3, r4, r3
/* 8016215C 0015D67C  90 7E 00 24 */	stw r3, 0x24(r30)
/* 80162160 0015D680  50 06 E8 04 */	rlwimi r6, r0, 0x1d, 0, 2
/* 80162164 0015D684  80 01 00 08 */	lwz r0, 8(r1)
/* 80162168 0015D688  7C 00 28 50 */	subf r0, r0, r5
/* 8016216C 0015D68C  90 DE 00 08 */	stw r6, 8(r30)
/* 80162170 0015D690  90 1E 00 28 */	stw r0, 0x28(r30)
/* 80162174 0015D694  48 00 00 10 */	b lbl_80162184
lbl_80162178:
/* 80162178 0015D698  80 1E 00 08 */	lwz r0, 8(r30)
/* 8016217C 0015D69C  54 00 00 FE */	clrlwi r0, r0, 3
/* 80162180 0015D6A0  90 1E 00 08 */	stw r0, 8(r30)
lbl_80162184:
/* 80162184 0015D6A4  80 1E 00 08 */	lwz r0, 8(r30)
/* 80162188 0015D6A8  54 00 1F 7F */	rlwinm. r0, r0, 3, 0x1d, 0x1f
/* 8016218C 0015D6AC  40 82 00 64 */	bne lbl_801621F0
/* 80162190 0015D6B0  81 9E 00 38 */	lwz r12, 0x38(r30)
/* 80162194 0015D6B4  2C 0C 00 00 */	cmpwi r12, 0
/* 80162198 0015D6B8  41 82 00 44 */	beq lbl_801621DC
/* 8016219C 0015D6BC  7F E5 FB 78 */	mr r5, r31
/* 801621A0 0015D6C0  38 81 00 08 */	addi r4, r1, 8
/* 801621A4 0015D6C4  80 7E 00 00 */	lwz r3, 0(r30)
/* 801621A8 0015D6C8  80 DE 00 48 */	lwz r6, 0x48(r30)
/* 801621AC 0015D6CC  7D 89 03 A6 */	mtctr r12
/* 801621B0 0015D6D0  4E 80 04 21 */	bctrl 
/* 801621B4 0015D6D4  2C 03 00 00 */	cmpwi r3, 0
/* 801621B8 0015D6D8  41 82 00 24 */	beq lbl_801621DC
/* 801621BC 0015D6DC  38 00 00 01 */	li r0, 1
/* 801621C0 0015D6E0  38 80 00 00 */	li r4, 0
/* 801621C4 0015D6E4  98 1E 00 0A */	stb r0, 0xa(r30)
/* 801621C8 0015D6E8  38 00 00 28 */	li r0, 0x28
/* 801621CC 0015D6EC  38 60 FF FF */	li r3, -1
/* 801621D0 0015D6F0  90 9E 00 28 */	stw r4, 0x28(r30)
/* 801621D4 0015D6F4  90 0D 93 40 */	stw r0, lbl_802477C0@sda21(r13)
/* 801621D8 0015D6F8  48 00 00 1C */	b lbl_801621F4
lbl_801621DC:
/* 801621DC 0015D6FC  38 60 00 00 */	li r3, 0
/* 801621E0 0015D700  98 7E 00 09 */	stb r3, 9(r30)
/* 801621E4 0015D704  80 01 00 08 */	lwz r0, 8(r1)
/* 801621E8 0015D708  90 1E 00 18 */	stw r0, 0x18(r30)
/* 801621EC 0015D70C  90 7E 00 28 */	stw r3, 0x28(r30)
lbl_801621F0:
/* 801621F0 0015D710  38 60 00 00 */	li r3, 0
lbl_801621F4:
/* 801621F4 0015D714  80 01 00 24 */	lwz r0, 0x24(r1)
/* 801621F8 0015D718  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 801621FC 0015D71C  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 80162200 0015D720  7C 08 03 A6 */	mtlr r0
/* 80162204 0015D724  38 21 00 20 */	addi r1, r1, 0x20
/* 80162208 0015D728  4E 80 00 20 */	blr

.section .sbss, "wa" # 0x80246B60 - 0x80247800

glabel lbl_802477C0
	.skip 0x8