.include "macros.inc"

.section .text, "ax"

glabel MEMCreateFrmHeapEx
/* 800B78E8 000B2E08  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 800B78EC 000B2E0C  7C 08 02 A6 */	mflr r0
/* 800B78F0 000B2E10  7C 84 1A 14 */	add r4, r4, r3
/* 800B78F4 000B2E14  90 01 00 14 */	stw r0, 0x14(r1)
/* 800B78F8 000B2E18  38 03 00 03 */	addi r0, r3, 3
/* 800B78FC 000B2E1C  54 86 00 3A */	rlwinm r6, r4, 0, 0, 0x1d
/* 800B7900 000B2E20  93 E1 00 0C */	stw r31, 0xc(r1)
/* 800B7904 000B2E24  54 1F 00 3A */	rlwinm r31, r0, 0, 0, 0x1d
/* 800B7908 000B2E28  7C 1F 30 40 */	cmplw r31, r6
/* 800B790C 000B2E2C  41 81 00 10 */	bgt .L_800B791C
/* 800B7910 000B2E30  7C 1F 30 50 */	subf r0, r31, r6
/* 800B7914 000B2E34  28 00 00 48 */	cmplwi r0, 0x48
/* 800B7918 000B2E38  40 80 00 0C */	bge .L_800B7924
.L_800B791C:
/* 800B791C 000B2E3C  38 60 00 00 */	li r3, 0
/* 800B7920 000B2E40  48 00 00 38 */	b .L_800B7958
.L_800B7924:
/* 800B7924 000B2E44  3C 80 46 52 */	lis r4, 0x46524D48@ha
/* 800B7928 000B2E48  7C A7 2B 78 */	mr r7, r5
/* 800B792C 000B2E4C  7F E3 FB 78 */	mr r3, r31
/* 800B7930 000B2E50  38 BF 00 48 */	addi r5, r31, 0x48
/* 800B7934 000B2E54  38 84 4D 48 */	addi r4, r4, 0x46524D48@l
/* 800B7938 000B2E58  4B FF F5 19 */	bl MEMiInitHeapHead
/* 800B793C 000B2E5C  80 9F 00 18 */	lwz r4, 0x18(r31)
/* 800B7940 000B2E60  38 00 00 00 */	li r0, 0
/* 800B7944 000B2E64  7F E3 FB 78 */	mr r3, r31
/* 800B7948 000B2E68  90 9F 00 3C */	stw r4, 0x3c(r31)
/* 800B794C 000B2E6C  80 9F 00 1C */	lwz r4, 0x1c(r31)
/* 800B7950 000B2E70  90 9F 00 40 */	stw r4, 0x40(r31)
/* 800B7954 000B2E74  90 1F 00 44 */	stw r0, 0x44(r31)
.L_800B7958:
/* 800B7958 000B2E78  80 01 00 14 */	lwz r0, 0x14(r1)
/* 800B795C 000B2E7C  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 800B7960 000B2E80  7C 08 03 A6 */	mtlr r0
/* 800B7964 000B2E84  38 21 00 10 */	addi r1, r1, 0x10
/* 800B7968 000B2E88  4E 80 00 20 */	blr

glabel MEMDestroyFrmHeap
/* 800B796C 000B2E8C  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 800B7970 000B2E90  7C 08 02 A6 */	mflr r0
/* 800B7974 000B2E94  90 01 00 14 */	stw r0, 0x14(r1)
/* 800B7978 000B2E98  93 E1 00 0C */	stw r31, 0xc(r1)
/* 800B797C 000B2E9C  7C 7F 1B 78 */	mr r31, r3
/* 800B7980 000B2EA0  4B FF F6 91 */	bl MEMiFinalizeHeap
/* 800B7984 000B2EA4  7F E3 FB 78 */	mr r3, r31
/* 800B7988 000B2EA8  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 800B798C 000B2EAC  80 01 00 14 */	lwz r0, 0x14(r1)
/* 800B7990 000B2EB0  7C 08 03 A6 */	mtlr r0
/* 800B7994 000B2EB4  38 21 00 10 */	addi r1, r1, 0x10
/* 800B7998 000B2EB8  4E 80 00 20 */	blr

glabel MEMAllocFromFrmHeapEx
/* 800B799C 000B2EBC  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 800B79A0 000B2EC0  7C 08 02 A6 */	mflr r0
/* 800B79A4 000B2EC4  2C 04 00 00 */	cmpwi r4, 0
/* 800B79A8 000B2EC8  90 01 00 24 */	stw r0, 0x24(r1)
/* 800B79AC 000B2ECC  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 800B79B0 000B2ED0  7C 7F 1B 78 */	mr r31, r3
/* 800B79B4 000B2ED4  93 C1 00 18 */	stw r30, 0x18(r1)
/* 800B79B8 000B2ED8  7C 9E 23 78 */	mr r30, r4
/* 800B79BC 000B2EDC  93 A1 00 14 */	stw r29, 0x14(r1)
/* 800B79C0 000B2EE0  7C BD 2B 78 */	mr r29, r5
/* 800B79C4 000B2EE4  40 82 00 08 */	bne .L_800B79CC
/* 800B79C8 000B2EE8  3B C0 00 01 */	li r30, 1
.L_800B79CC:
/* 800B79CC 000B2EEC  80 03 00 38 */	lwz r0, 0x38(r3)
/* 800B79D0 000B2EF0  38 9E 00 03 */	addi r4, r30, 3
/* 800B79D4 000B2EF4  54 9E 00 3A */	rlwinm r30, r4, 0, 0, 0x1d
/* 800B79D8 000B2EF8  54 00 07 7B */	rlwinm. r0, r0, 0, 0x1d, 0x1d
/* 800B79DC 000B2EFC  41 82 00 0C */	beq .L_800B79E8
/* 800B79E0 000B2F00  38 63 00 20 */	addi r3, r3, 0x20
/* 800B79E4 000B2F04  4B FD EA BD */	bl OSLockMutex
.L_800B79E8:
/* 800B79E8 000B2F08  2C 1D 00 00 */	cmpwi r29, 0
/* 800B79EC 000B2F0C  41 80 00 54 */	blt .L_800B7A40
/* 800B79F0 000B2F10  80 7F 00 3C */	lwz r3, 0x3c(r31)
/* 800B79F4 000B2F14  38 1D FF FF */	addi r0, r29, -1
/* 800B79F8 000B2F18  7C 05 00 F8 */	nor r5, r0, r0
/* 800B79FC 000B2F1C  80 1F 00 40 */	lwz r0, 0x40(r31)
/* 800B7A00 000B2F20  7C 9D 1A 14 */	add r4, r29, r3
/* 800B7A04 000B2F24  38 84 FF FF */	addi r4, r4, -1
/* 800B7A08 000B2F28  7C BD 20 38 */	and r29, r5, r4
/* 800B7A0C 000B2F2C  7F DE EA 14 */	add r30, r30, r29
/* 800B7A10 000B2F30  7C 1E 00 40 */	cmplw r30, r0
/* 800B7A14 000B2F34  40 81 00 0C */	ble .L_800B7A20
/* 800B7A18 000B2F38  3B A0 00 00 */	li r29, 0
/* 800B7A1C 000B2F3C  48 00 00 6C */	b .L_800B7A88
.L_800B7A20:
/* 800B7A20 000B2F40  80 1F 00 38 */	lwz r0, 0x38(r31)
/* 800B7A24 000B2F44  7C A3 F0 50 */	subf r5, r3, r30
/* 800B7A28 000B2F48  54 00 07 FF */	clrlwi. r0, r0, 0x1f
/* 800B7A2C 000B2F4C  41 82 00 0C */	beq .L_800B7A38
/* 800B7A30 000B2F50  38 80 00 00 */	li r4, 0
/* 800B7A34 000B2F54  4B F4 CA 09 */	bl memset
.L_800B7A38:
/* 800B7A38 000B2F58  93 DF 00 3C */	stw r30, 0x3c(r31)
/* 800B7A3C 000B2F5C  48 00 00 4C */	b .L_800B7A88
.L_800B7A40:
/* 800B7A40 000B2F60  80 BF 00 40 */	lwz r5, 0x40(r31)
/* 800B7A44 000B2F64  20 1D FF FF */	subfic r0, r29, -1
/* 800B7A48 000B2F68  7C 04 00 F8 */	nor r4, r0, r0
/* 800B7A4C 000B2F6C  80 1F 00 3C */	lwz r0, 0x3c(r31)
/* 800B7A50 000B2F70  7C 7E 28 50 */	subf r3, r30, r5
/* 800B7A54 000B2F74  7C 9D 18 38 */	and r29, r4, r3
/* 800B7A58 000B2F78  7C 1D 00 40 */	cmplw r29, r0
/* 800B7A5C 000B2F7C  40 80 00 0C */	bge .L_800B7A68
/* 800B7A60 000B2F80  3B A0 00 00 */	li r29, 0
/* 800B7A64 000B2F84  48 00 00 24 */	b .L_800B7A88
.L_800B7A68:
/* 800B7A68 000B2F88  80 1F 00 38 */	lwz r0, 0x38(r31)
/* 800B7A6C 000B2F8C  7C BD 28 50 */	subf r5, r29, r5
/* 800B7A70 000B2F90  54 00 07 FF */	clrlwi. r0, r0, 0x1f
/* 800B7A74 000B2F94  41 82 00 10 */	beq .L_800B7A84
/* 800B7A78 000B2F98  7F A3 EB 78 */	mr r3, r29
/* 800B7A7C 000B2F9C  38 80 00 00 */	li r4, 0
/* 800B7A80 000B2FA0  4B F4 C9 BD */	bl memset
.L_800B7A84:
/* 800B7A84 000B2FA4  93 BF 00 40 */	stw r29, 0x40(r31)
.L_800B7A88:
/* 800B7A88 000B2FA8  80 1F 00 38 */	lwz r0, 0x38(r31)
/* 800B7A8C 000B2FAC  54 00 07 7B */	rlwinm. r0, r0, 0, 0x1d, 0x1d
/* 800B7A90 000B2FB0  41 82 00 0C */	beq .L_800B7A9C
/* 800B7A94 000B2FB4  38 7F 00 20 */	addi r3, r31, 0x20
/* 800B7A98 000B2FB8  4B FD EA E5 */	bl OSUnlockMutex
.L_800B7A9C:
/* 800B7A9C 000B2FBC  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 800B7AA0 000B2FC0  7F A3 EB 78 */	mr r3, r29
/* 800B7AA4 000B2FC4  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 800B7AA8 000B2FC8  83 A1 00 14 */	lwz r29, 0x14(r1)
/* 800B7AAC 000B2FCC  80 01 00 24 */	lwz r0, 0x24(r1)
/* 800B7AB0 000B2FD0  7C 08 03 A6 */	mtlr r0
/* 800B7AB4 000B2FD4  38 21 00 20 */	addi r1, r1, 0x20
/* 800B7AB8 000B2FD8  4E 80 00 20 */	blr

glabel MEMFreeToFrmHeap
/* 800B7ABC 000B2FDC  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 800B7AC0 000B2FE0  7C 08 02 A6 */	mflr r0
/* 800B7AC4 000B2FE4  90 01 00 14 */	stw r0, 0x14(r1)
/* 800B7AC8 000B2FE8  93 E1 00 0C */	stw r31, 0xc(r1)
/* 800B7ACC 000B2FEC  7C 9F 23 78 */	mr r31, r4
/* 800B7AD0 000B2FF0  93 C1 00 08 */	stw r30, 8(r1)
/* 800B7AD4 000B2FF4  7C 7E 1B 78 */	mr r30, r3
/* 800B7AD8 000B2FF8  80 03 00 38 */	lwz r0, 0x38(r3)
/* 800B7ADC 000B2FFC  54 00 07 7B */	rlwinm. r0, r0, 0, 0x1d, 0x1d
/* 800B7AE0 000B3000  41 82 00 0C */	beq .L_800B7AEC
/* 800B7AE4 000B3004  38 63 00 20 */	addi r3, r3, 0x20
/* 800B7AE8 000B3008  4B FD E9 B9 */	bl OSLockMutex
.L_800B7AEC:
/* 800B7AEC 000B300C  57 E0 07 FF */	clrlwi. r0, r31, 0x1f
/* 800B7AF0 000B3010  41 82 00 14 */	beq .L_800B7B04
/* 800B7AF4 000B3014  80 7E 00 18 */	lwz r3, 0x18(r30)
/* 800B7AF8 000B3018  38 00 00 00 */	li r0, 0
/* 800B7AFC 000B301C  90 1E 00 44 */	stw r0, 0x44(r30)
/* 800B7B00 000B3020  90 7E 00 3C */	stw r3, 0x3c(r30)
.L_800B7B04:
/* 800B7B04 000B3024  57 E0 07 BD */	rlwinm. r0, r31, 0, 0x1e, 0x1e
/* 800B7B08 000B3028  41 82 00 28 */	beq .L_800B7B30
/* 800B7B0C 000B302C  80 7E 00 44 */	lwz r3, 0x44(r30)
/* 800B7B10 000B3030  48 00 00 10 */	b .L_800B7B20
.L_800B7B14:
/* 800B7B14 000B3034  80 1E 00 1C */	lwz r0, 0x1c(r30)
/* 800B7B18 000B3038  90 03 00 08 */	stw r0, 8(r3)
/* 800B7B1C 000B303C  80 63 00 0C */	lwz r3, 0xc(r3)
.L_800B7B20:
/* 800B7B20 000B3040  2C 03 00 00 */	cmpwi r3, 0
/* 800B7B24 000B3044  40 82 FF F0 */	bne .L_800B7B14
/* 800B7B28 000B3048  80 1E 00 1C */	lwz r0, 0x1c(r30)
/* 800B7B2C 000B304C  90 1E 00 40 */	stw r0, 0x40(r30)
.L_800B7B30:
/* 800B7B30 000B3050  80 1E 00 38 */	lwz r0, 0x38(r30)
/* 800B7B34 000B3054  54 00 07 7B */	rlwinm. r0, r0, 0, 0x1d, 0x1d
/* 800B7B38 000B3058  41 82 00 0C */	beq .L_800B7B44
/* 800B7B3C 000B305C  38 7E 00 20 */	addi r3, r30, 0x20
/* 800B7B40 000B3060  4B FD EA 3D */	bl OSUnlockMutex
.L_800B7B44:
/* 800B7B44 000B3064  80 01 00 14 */	lwz r0, 0x14(r1)
/* 800B7B48 000B3068  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 800B7B4C 000B306C  83 C1 00 08 */	lwz r30, 8(r1)
/* 800B7B50 000B3070  7C 08 03 A6 */	mtlr r0
/* 800B7B54 000B3074  38 21 00 10 */	addi r1, r1, 0x10
/* 800B7B58 000B3078  4E 80 00 20 */	blr

glabel MEMGetAllocatableSizeForFrmHeapEx
/* 800B7B5C 000B307C  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 800B7B60 000B3080  7C 08 02 A6 */	mflr r0
/* 800B7B64 000B3084  90 01 00 14 */	stw r0, 0x14(r1)
/* 800B7B68 000B3088  7C 80 FE 70 */	srawi r0, r4, 0x1f
/* 800B7B6C 000B308C  93 E1 00 0C */	stw r31, 0xc(r1)
/* 800B7B70 000B3090  7C 1F 22 78 */	xor r31, r0, r4
/* 800B7B74 000B3094  7F E0 F8 50 */	subf r31, r0, r31
/* 800B7B78 000B3098  93 C1 00 08 */	stw r30, 8(r1)
/* 800B7B7C 000B309C  7C 7E 1B 78 */	mr r30, r3
/* 800B7B80 000B30A0  4B FD D7 35 */	bl OSDisableInterrupts
/* 800B7B84 000B30A4  80 1E 00 3C */	lwz r0, 0x3c(r30)
/* 800B7B88 000B30A8  38 9F FF FF */	addi r4, r31, -1
/* 800B7B8C 000B30AC  7C 85 20 F8 */	nor r5, r4, r4
/* 800B7B90 000B30B0  80 DE 00 40 */	lwz r6, 0x40(r30)
/* 800B7B94 000B30B4  7C 9F 02 14 */	add r4, r31, r0
/* 800B7B98 000B30B8  38 04 FF FF */	addi r0, r4, -1
/* 800B7B9C 000B30BC  7C A0 00 38 */	and r0, r5, r0
/* 800B7BA0 000B30C0  7C 00 30 40 */	cmplw r0, r6
/* 800B7BA4 000B30C4  40 81 00 0C */	ble .L_800B7BB0
/* 800B7BA8 000B30C8  3B E0 00 00 */	li r31, 0
/* 800B7BAC 000B30CC  48 00 00 08 */	b .L_800B7BB4
.L_800B7BB0:
/* 800B7BB0 000B30D0  7F E0 30 50 */	subf r31, r0, r6
.L_800B7BB4:
/* 800B7BB4 000B30D4  4B FD D7 29 */	bl OSRestoreInterrupts
/* 800B7BB8 000B30D8  7F E3 FB 78 */	mr r3, r31
/* 800B7BBC 000B30DC  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 800B7BC0 000B30E0  83 C1 00 08 */	lwz r30, 8(r1)
/* 800B7BC4 000B30E4  80 01 00 14 */	lwz r0, 0x14(r1)
/* 800B7BC8 000B30E8  7C 08 03 A6 */	mtlr r0
/* 800B7BCC 000B30EC  38 21 00 10 */	addi r1, r1, 0x10
/* 800B7BD0 000B30F0  4E 80 00 20 */	blr
