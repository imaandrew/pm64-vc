.include "macros.inc"

.section .text, "ax"

glabel MEMCreateUnitHeapEx
/* 800B7BD4 000B30F4  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 800B7BD8 000B30F8  7C 08 02 A6 */	mflr r0
/* 800B7BDC 000B30FC  90 01 00 24 */	stw r0, 0x24(r1)
/* 800B7BE0 000B3100  39 61 00 20 */	addi r11, r1, 0x20
/* 800B7BE4 000B3104  48 0A 4D 61 */	bl _savegpr_27
/* 800B7BE8 000B3108  39 03 00 03 */	addi r8, r3, 3
/* 800B7BEC 000B310C  7C 04 1A 14 */	add r0, r4, r3
/* 800B7BF0 000B3110  55 1F 00 3A */	rlwinm r31, r8, 0, 0, 0x1d
/* 800B7BF4 000B3114  54 08 00 3A */	rlwinm r8, r0, 0, 0, 0x1d
/* 800B7BF8 000B3118  7C 08 F8 51 */	subf. r0, r8, r31
/* 800B7BFC 000B311C  40 81 00 0C */	ble .L_800B7C08
/* 800B7C00 000B3120  38 60 00 00 */	li r3, 0
/* 800B7C04 000B3124  48 00 01 14 */	b .L_800B7D18
.L_800B7C08:
/* 800B7C08 000B3128  3B DF 00 3C */	addi r30, r31, 0x3c
/* 800B7C0C 000B312C  38 06 FF FF */	addi r0, r6, -1
/* 800B7C10 000B3130  7C 7E 32 14 */	add r3, r30, r6
/* 800B7C14 000B3134  7C 86 2A 14 */	add r4, r6, r5
/* 800B7C18 000B3138  7C 05 00 F8 */	nor r5, r0, r0
/* 800B7C1C 000B313C  38 03 00 07 */	addi r0, r3, 7
/* 800B7C20 000B3140  38 64 FF FF */	addi r3, r4, -1
/* 800B7C24 000B3144  7C BC 00 38 */	and r28, r5, r0
/* 800B7C28 000B3148  7C 08 E0 51 */	subf. r0, r8, r28
/* 800B7C2C 000B314C  7C BB 18 38 */	and r27, r5, r3
/* 800B7C30 000B3150  40 81 00 0C */	ble .L_800B7C3C
/* 800B7C34 000B3154  38 60 00 00 */	li r3, 0
/* 800B7C38 000B3158  48 00 00 E0 */	b .L_800B7D18
.L_800B7C3C:
/* 800B7C3C 000B315C  7C 1C 40 50 */	subf r0, r28, r8
/* 800B7C40 000B3160  7F A0 DB 97 */	divwu. r29, r0, r27
/* 800B7C44 000B3164  40 82 00 0C */	bne .L_800B7C50
/* 800B7C48 000B3168  38 60 00 00 */	li r3, 0
/* 800B7C4C 000B316C  48 00 00 CC */	b .L_800B7D18
.L_800B7C50:
/* 800B7C50 000B3170  7C 1D D9 D6 */	mullw r0, r29, r27
/* 800B7C54 000B3174  3C 80 55 4E */	lis r4, 0x554E5448@ha
/* 800B7C58 000B3178  7F E3 FB 78 */	mr r3, r31
/* 800B7C5C 000B317C  7F 85 E3 78 */	mr r5, r28
/* 800B7C60 000B3180  38 84 54 48 */	addi r4, r4, 0x554E5448@l
/* 800B7C64 000B3184  7C C0 E2 14 */	add r6, r0, r28
/* 800B7C68 000B3188  4B FF F1 E9 */	bl MEMiInitHeapHead
/* 800B7C6C 000B318C  38 7D FF FF */	addi r3, r29, -1
/* 800B7C70 000B3190  93 9E 00 00 */	stw r28, 0(r30)
/* 800B7C74 000B3194  28 03 00 00 */	cmplwi r3, 0
/* 800B7C78 000B3198  93 7E 00 04 */	stw r27, 4(r30)
/* 800B7C7C 000B319C  40 81 00 90 */	ble .L_800B7D0C
/* 800B7C80 000B31A0  54 60 E8 FF */	rlwinm. r0, r3, 0x1d, 3, 0x1f
/* 800B7C84 000B31A4  7C 09 03 A6 */	mtctr r0
/* 800B7C88 000B31A8  41 82 00 70 */	beq .L_800B7CF8
.L_800B7C8C:
/* 800B7C8C 000B31AC  7C 1B E2 14 */	add r0, r27, r28
/* 800B7C90 000B31B0  90 1C 00 00 */	stw r0, 0(r28)
/* 800B7C94 000B31B4  7C 1C 03 78 */	mr r28, r0
/* 800B7C98 000B31B8  7C 1B 02 14 */	add r0, r27, r0
/* 800B7C9C 000B31BC  90 1C 00 00 */	stw r0, 0(r28)
/* 800B7CA0 000B31C0  7C 1C 03 78 */	mr r28, r0
/* 800B7CA4 000B31C4  7C 1B 02 14 */	add r0, r27, r0
/* 800B7CA8 000B31C8  90 1C 00 00 */	stw r0, 0(r28)
/* 800B7CAC 000B31CC  7C 1C 03 78 */	mr r28, r0
/* 800B7CB0 000B31D0  7C 1B 02 14 */	add r0, r27, r0
/* 800B7CB4 000B31D4  90 1C 00 00 */	stw r0, 0(r28)
/* 800B7CB8 000B31D8  7C 1C 03 78 */	mr r28, r0
/* 800B7CBC 000B31DC  7C 1B 02 14 */	add r0, r27, r0
/* 800B7CC0 000B31E0  90 1C 00 00 */	stw r0, 0(r28)
/* 800B7CC4 000B31E4  7C 1C 03 78 */	mr r28, r0
/* 800B7CC8 000B31E8  7C 1B 02 14 */	add r0, r27, r0
/* 800B7CCC 000B31EC  90 1C 00 00 */	stw r0, 0(r28)
/* 800B7CD0 000B31F0  7C 1C 03 78 */	mr r28, r0
/* 800B7CD4 000B31F4  7C 1B 02 14 */	add r0, r27, r0
/* 800B7CD8 000B31F8  90 1C 00 00 */	stw r0, 0(r28)
/* 800B7CDC 000B31FC  7C 1C 03 78 */	mr r28, r0
/* 800B7CE0 000B3200  7C 1B 02 14 */	add r0, r27, r0
/* 800B7CE4 000B3204  90 1C 00 00 */	stw r0, 0(r28)
/* 800B7CE8 000B3208  7C 1C 03 78 */	mr r28, r0
/* 800B7CEC 000B320C  42 00 FF A0 */	bdnz .L_800B7C8C
/* 800B7CF0 000B3210  70 63 00 07 */	andi. r3, r3, 7
/* 800B7CF4 000B3214  41 82 00 18 */	beq .L_800B7D0C
.L_800B7CF8:
/* 800B7CF8 000B3218  7C 69 03 A6 */	mtctr r3
.L_800B7CFC:
/* 800B7CFC 000B321C  7C 1B E2 14 */	add r0, r27, r28
/* 800B7D00 000B3220  90 1C 00 00 */	stw r0, 0(r28)
/* 800B7D04 000B3224  7C 1C 03 78 */	mr r28, r0
/* 800B7D08 000B3228  42 00 FF F4 */	bdnz .L_800B7CFC
.L_800B7D0C:
/* 800B7D0C 000B322C  38 00 00 00 */	li r0, 0
/* 800B7D10 000B3230  7F E3 FB 78 */	mr r3, r31
/* 800B7D14 000B3234  90 1C 00 00 */	stw r0, 0(r28)
.L_800B7D18:
/* 800B7D18 000B3238  39 61 00 20 */	addi r11, r1, 0x20
/* 800B7D1C 000B323C  48 0A 4C 75 */	bl _restgpr_27
/* 800B7D20 000B3240  80 01 00 24 */	lwz r0, 0x24(r1)
/* 800B7D24 000B3244  7C 08 03 A6 */	mtlr r0
/* 800B7D28 000B3248  38 21 00 20 */	addi r1, r1, 0x20
/* 800B7D2C 000B324C  4E 80 00 20 */	blr

glabel MEMAllocFromUnitHeap
/* 800B7D30 000B3250  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 800B7D34 000B3254  7C 08 02 A6 */	mflr r0
/* 800B7D38 000B3258  90 01 00 14 */	stw r0, 0x14(r1)
/* 800B7D3C 000B325C  93 E1 00 0C */	stw r31, 0xc(r1)
/* 800B7D40 000B3260  93 C1 00 08 */	stw r30, 8(r1)
/* 800B7D44 000B3264  7C 7E 1B 78 */	mr r30, r3
/* 800B7D48 000B3268  80 03 00 38 */	lwz r0, 0x38(r3)
/* 800B7D4C 000B326C  54 00 07 7B */	rlwinm. r0, r0, 0, 0x1d, 0x1d
/* 800B7D50 000B3270  41 82 00 0C */	beq .L_800B7D5C
/* 800B7D54 000B3274  38 63 00 20 */	addi r3, r3, 0x20
/* 800B7D58 000B3278  4B FD E7 49 */	bl OSLockMutex
.L_800B7D5C:
/* 800B7D5C 000B327C  83 FE 00 3C */	lwz r31, 0x3c(r30)
/* 800B7D60 000B3280  2C 1F 00 00 */	cmpwi r31, 0
/* 800B7D64 000B3284  41 82 00 0C */	beq .L_800B7D70
/* 800B7D68 000B3288  80 1F 00 00 */	lwz r0, 0(r31)
/* 800B7D6C 000B328C  90 1E 00 3C */	stw r0, 0x3c(r30)
.L_800B7D70:
/* 800B7D70 000B3290  80 1E 00 38 */	lwz r0, 0x38(r30)
/* 800B7D74 000B3294  54 00 07 7B */	rlwinm. r0, r0, 0, 0x1d, 0x1d
/* 800B7D78 000B3298  41 82 00 0C */	beq .L_800B7D84
/* 800B7D7C 000B329C  38 7E 00 20 */	addi r3, r30, 0x20
/* 800B7D80 000B32A0  4B FD E7 FD */	bl OSUnlockMutex
.L_800B7D84:
/* 800B7D84 000B32A4  2C 1F 00 00 */	cmpwi r31, 0
/* 800B7D88 000B32A8  41 82 00 20 */	beq .L_800B7DA8
/* 800B7D8C 000B32AC  80 1E 00 38 */	lwz r0, 0x38(r30)
/* 800B7D90 000B32B0  80 BE 00 40 */	lwz r5, 0x40(r30)
/* 800B7D94 000B32B4  54 00 07 FF */	clrlwi. r0, r0, 0x1f
/* 800B7D98 000B32B8  41 82 00 10 */	beq .L_800B7DA8
/* 800B7D9C 000B32BC  7F E3 FB 78 */	mr r3, r31
/* 800B7DA0 000B32C0  38 80 00 00 */	li r4, 0
/* 800B7DA4 000B32C4  4B F4 C6 99 */	bl memset
.L_800B7DA8:
/* 800B7DA8 000B32C8  7F E3 FB 78 */	mr r3, r31
/* 800B7DAC 000B32CC  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 800B7DB0 000B32D0  83 C1 00 08 */	lwz r30, 8(r1)
/* 800B7DB4 000B32D4  80 01 00 14 */	lwz r0, 0x14(r1)
/* 800B7DB8 000B32D8  7C 08 03 A6 */	mtlr r0
/* 800B7DBC 000B32DC  38 21 00 10 */	addi r1, r1, 0x10
/* 800B7DC0 000B32E0  4E 80 00 20 */	blr

glabel MEMFreeToUnitHeap
/* 800B7DC4 000B32E4  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 800B7DC8 000B32E8  7C 08 02 A6 */	mflr r0
/* 800B7DCC 000B32EC  2C 04 00 00 */	cmpwi r4, 0
/* 800B7DD0 000B32F0  90 01 00 14 */	stw r0, 0x14(r1)
/* 800B7DD4 000B32F4  93 E1 00 0C */	stw r31, 0xc(r1)
/* 800B7DD8 000B32F8  7C 9F 23 78 */	mr r31, r4
/* 800B7DDC 000B32FC  93 C1 00 08 */	stw r30, 8(r1)
/* 800B7DE0 000B3300  7C 7E 1B 78 */	mr r30, r3
/* 800B7DE4 000B3304  41 82 00 38 */	beq .L_800B7E1C
/* 800B7DE8 000B3308  80 03 00 38 */	lwz r0, 0x38(r3)
/* 800B7DEC 000B330C  54 00 07 7B */	rlwinm. r0, r0, 0, 0x1d, 0x1d
/* 800B7DF0 000B3310  41 82 00 0C */	beq .L_800B7DFC
/* 800B7DF4 000B3314  38 63 00 20 */	addi r3, r3, 0x20
/* 800B7DF8 000B3318  4B FD E6 A9 */	bl OSLockMutex
.L_800B7DFC:
/* 800B7DFC 000B331C  80 1E 00 3C */	lwz r0, 0x3c(r30)
/* 800B7E00 000B3320  90 1F 00 00 */	stw r0, 0(r31)
/* 800B7E04 000B3324  80 1E 00 38 */	lwz r0, 0x38(r30)
/* 800B7E08 000B3328  93 FE 00 3C */	stw r31, 0x3c(r30)
/* 800B7E0C 000B332C  54 00 07 7B */	rlwinm. r0, r0, 0, 0x1d, 0x1d
/* 800B7E10 000B3330  41 82 00 0C */	beq .L_800B7E1C
/* 800B7E14 000B3334  38 7E 00 20 */	addi r3, r30, 0x20
/* 800B7E18 000B3338  4B FD E7 65 */	bl OSUnlockMutex
.L_800B7E1C:
/* 800B7E1C 000B333C  80 01 00 14 */	lwz r0, 0x14(r1)
/* 800B7E20 000B3340  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 800B7E24 000B3344  83 C1 00 08 */	lwz r30, 8(r1)
/* 800B7E28 000B3348  7C 08 03 A6 */	mtlr r0
/* 800B7E2C 000B334C  38 21 00 10 */	addi r1, r1, 0x10
/* 800B7E30 000B3350  4E 80 00 20 */	blr

glabel MEMCountFreeBlockForUnitHeap
/* 800B7E34 000B3354  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 800B7E38 000B3358  7C 08 02 A6 */	mflr r0
/* 800B7E3C 000B335C  90 01 00 14 */	stw r0, 0x14(r1)
/* 800B7E40 000B3360  93 E1 00 0C */	stw r31, 0xc(r1)
/* 800B7E44 000B3364  3B E0 00 00 */	li r31, 0
/* 800B7E48 000B3368  93 C1 00 08 */	stw r30, 8(r1)
/* 800B7E4C 000B336C  7C 7E 1B 78 */	mr r30, r3
/* 800B7E50 000B3370  80 03 00 38 */	lwz r0, 0x38(r3)
/* 800B7E54 000B3374  54 00 07 7B */	rlwinm. r0, r0, 0, 0x1d, 0x1d
/* 800B7E58 000B3378  41 82 00 0C */	beq .L_800B7E64
/* 800B7E5C 000B337C  38 63 00 20 */	addi r3, r3, 0x20
/* 800B7E60 000B3380  4B FD E6 41 */	bl OSLockMutex
.L_800B7E64:
/* 800B7E64 000B3384  80 7E 00 3C */	lwz r3, 0x3c(r30)
/* 800B7E68 000B3388  48 00 00 0C */	b .L_800B7E74
.L_800B7E6C:
/* 800B7E6C 000B338C  80 63 00 00 */	lwz r3, 0(r3)
/* 800B7E70 000B3390  3B FF 00 01 */	addi r31, r31, 1
.L_800B7E74:
/* 800B7E74 000B3394  2C 03 00 00 */	cmpwi r3, 0
/* 800B7E78 000B3398  40 82 FF F4 */	bne .L_800B7E6C
/* 800B7E7C 000B339C  80 1E 00 38 */	lwz r0, 0x38(r30)
/* 800B7E80 000B33A0  54 00 07 7B */	rlwinm. r0, r0, 0, 0x1d, 0x1d
/* 800B7E84 000B33A4  41 82 00 0C */	beq .L_800B7E90
/* 800B7E88 000B33A8  38 7E 00 20 */	addi r3, r30, 0x20
/* 800B7E8C 000B33AC  4B FD E6 F1 */	bl OSUnlockMutex
.L_800B7E90:
/* 800B7E90 000B33B0  7F E3 FB 78 */	mr r3, r31
/* 800B7E94 000B33B4  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 800B7E98 000B33B8  83 C1 00 08 */	lwz r30, 8(r1)
/* 800B7E9C 000B33BC  80 01 00 14 */	lwz r0, 0x14(r1)
/* 800B7EA0 000B33C0  7C 08 03 A6 */	mtlr r0
/* 800B7EA4 000B33C4  38 21 00 10 */	addi r1, r1, 0x10
/* 800B7EA8 000B33C8  4E 80 00 20 */	blr

glabel lbl_800B7EAC
/* 800B7EAC 000B33CC  7C 65 1B 78 */	mr r5, r3
/* 800B7EB0 000B33D0  80 63 00 04 */	lwz r3, 4(r3)
/* 800B7EB4 000B33D4  80 A5 00 08 */	lwz r5, 8(r5)
/* 800B7EB8 000B33D8  4B FF F8 B4 */	b MEMAllocFromExpHeapEx

glabel lbl_800B7EBC
/* 800B7EBC 000B33DC  80 63 00 04 */	lwz r3, 4(r3)
/* 800B7EC0 000B33E0  4B FF F9 5C */	b MEMFreeToExpHeap

glabel lbl_800B7EC4
/* 800B7EC4 000B33E4  7C 65 1B 78 */	mr r5, r3
/* 800B7EC8 000B33E8  80 63 00 04 */	lwz r3, 4(r3)
/* 800B7ECC 000B33EC  80 A5 00 08 */	lwz r5, 8(r5)
/* 800B7ED0 000B33F0  4B FF FA CC */	b MEMAllocFromFrmHeapEx

glabel lbl_800B7ED4
/* 800B7ED4 000B33F4  4E 80 00 20 */	blr

