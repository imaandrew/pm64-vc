.include "macros.inc"

.section .text, "ax"

glabel TPLBind
/* 80108F38 00104458  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 80108F3C 0010445C  7C 08 02 A6 */	mflr r0
/* 80108F40 00104460  90 01 00 14 */	stw r0, 0x14(r1)
/* 80108F44 00104464  93 E1 00 0C */	stw r31, 0xc(r1)
/* 80108F48 00104468  7C 7F 1B 78 */	mr r31, r3
/* 80108F4C 0010446C  80 83 00 00 */	lwz r4, 0(r3)
/* 80108F50 00104470  3C 04 FF E0 */	addis r0, r4, 0xffe0
/* 80108F54 00104474  28 00 AF 30 */	cmplwi r0, 0xaf30
/* 80108F58 00104478  41 82 00 1C */	beq .L_80108F74
/* 80108F5C 0010447C  3C A0 80 1A */	lis r5, lbl_801A0B00@ha
/* 80108F60 00104480  38 6D 86 88 */	addi r3, r13, lbl_80246B08@sda21
/* 80108F64 00104484  38 A5 0B 00 */	addi r5, r5, lbl_801A0B00@l
/* 80108F68 00104488  38 80 00 19 */	li r4, 0x19
/* 80108F6C 0010448C  4C C6 31 82 */	crclr 6
/* 80108F70 00104490  4B F8 89 CD */	bl OSPanic
.L_80108F74:
/* 80108F74 00104494  80 1F 00 08 */	lwz r0, 8(r31)
/* 80108F78 00104498  38 60 00 00 */	li r3, 0
/* 80108F7C 0010449C  38 A0 00 01 */	li r5, 1
/* 80108F80 001044A0  7C 00 FA 14 */	add r0, r0, r31
/* 80108F84 001044A4  90 1F 00 08 */	stw r0, 8(r31)
/* 80108F88 001044A8  48 00 00 A0 */	b .L_80109028
.L_80108F8C:
/* 80108F8C 001044AC  80 9F 00 08 */	lwz r4, 8(r31)
/* 80108F90 001044B0  54 66 1B 78 */	rlwinm r6, r3, 3, 0xd, 0x1c
/* 80108F94 001044B4  7C 04 30 2E */	lwzx r0, r4, r6
/* 80108F98 001044B8  2C 00 00 00 */	cmpwi r0, 0
/* 80108F9C 001044BC  41 82 00 38 */	beq .L_80108FD4
/* 80108FA0 001044C0  7C 1F 02 14 */	add r0, r31, r0
/* 80108FA4 001044C4  7C 04 31 2E */	stwx r0, r4, r6
/* 80108FA8 001044C8  80 9F 00 08 */	lwz r4, 8(r31)
/* 80108FAC 001044CC  7C 84 30 2E */	lwzx r4, r4, r6
/* 80108FB0 001044D0  88 04 00 23 */	lbz r0, 0x23(r4)
/* 80108FB4 001044D4  2C 00 00 00 */	cmpwi r0, 0
/* 80108FB8 001044D8  40 82 00 1C */	bne .L_80108FD4
/* 80108FBC 001044DC  80 04 00 08 */	lwz r0, 8(r4)
/* 80108FC0 001044E0  7C 1F 02 14 */	add r0, r31, r0
/* 80108FC4 001044E4  90 04 00 08 */	stw r0, 8(r4)
/* 80108FC8 001044E8  80 9F 00 08 */	lwz r4, 8(r31)
/* 80108FCC 001044EC  7C 84 30 2E */	lwzx r4, r4, r6
/* 80108FD0 001044F0  98 A4 00 23 */	stb r5, 0x23(r4)
.L_80108FD4:
/* 80108FD4 001044F4  80 1F 00 08 */	lwz r0, 8(r31)
/* 80108FD8 001044F8  7C 80 32 14 */	add r4, r0, r6
/* 80108FDC 001044FC  80 04 00 04 */	lwz r0, 4(r4)
/* 80108FE0 00104500  2C 00 00 00 */	cmpwi r0, 0
/* 80108FE4 00104504  41 82 00 40 */	beq .L_80109024
/* 80108FE8 00104508  7C 1F 02 14 */	add r0, r31, r0
/* 80108FEC 0010450C  90 04 00 04 */	stw r0, 4(r4)
/* 80108FF0 00104510  80 1F 00 08 */	lwz r0, 8(r31)
/* 80108FF4 00104514  7C 80 32 14 */	add r4, r0, r6
/* 80108FF8 00104518  80 84 00 04 */	lwz r4, 4(r4)
/* 80108FFC 0010451C  88 04 00 02 */	lbz r0, 2(r4)
/* 80109000 00104520  2C 00 00 00 */	cmpwi r0, 0
/* 80109004 00104524  40 82 00 20 */	bne .L_80109024
/* 80109008 00104528  80 04 00 08 */	lwz r0, 8(r4)
/* 8010900C 0010452C  7C 1F 02 14 */	add r0, r31, r0
/* 80109010 00104530  90 04 00 08 */	stw r0, 8(r4)
/* 80109014 00104534  80 1F 00 08 */	lwz r0, 8(r31)
/* 80109018 00104538  7C 80 32 14 */	add r4, r0, r6
/* 8010901C 0010453C  80 84 00 04 */	lwz r4, 4(r4)
/* 80109020 00104540  98 A4 00 02 */	stb r5, 2(r4)
.L_80109024:
/* 80109024 00104544  38 63 00 01 */	addi r3, r3, 1
.L_80109028:
/* 80109028 00104548  80 1F 00 04 */	lwz r0, 4(r31)
/* 8010902C 0010454C  54 64 04 3E */	clrlwi r4, r3, 0x10
/* 80109030 00104550  7C 04 00 40 */	cmplw r4, r0
/* 80109034 00104554  41 80 FF 58 */	blt .L_80108F8C
/* 80109038 00104558  80 01 00 14 */	lwz r0, 0x14(r1)
/* 8010903C 0010455C  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 80109040 00104560  7C 08 03 A6 */	mtlr r0
/* 80109044 00104564  38 21 00 10 */	addi r1, r1, 0x10
/* 80109048 00104568  4E 80 00 20 */	blr

glabel TPLGet
/* 8010904C 0010456C  80 A3 00 04 */	lwz r5, 4(r3)
/* 80109050 00104570  80 63 00 08 */	lwz r3, 8(r3)
/* 80109054 00104574  7C 04 2B 96 */	divwu r0, r4, r5
/* 80109058 00104578  7C 00 29 D6 */	mullw r0, r0, r5
/* 8010905C 0010457C  7C 00 20 50 */	subf r0, r0, r4
/* 80109060 00104580  54 00 18 38 */	slwi r0, r0, 3
/* 80109064 00104584  7C 63 02 14 */	add r3, r3, r0
/* 80109068 00104588  4E 80 00 20 */	blr

glabel TPLGetGXTexObjFromPalette
/* 8010906C 0010458C  94 21 FF D0 */	stwu r1, -0x30(r1)
/* 80109070 00104590  7C 08 02 A6 */	mflr r0
/* 80109074 00104594  90 01 00 34 */	stw r0, 0x34(r1)
/* 80109078 00104598  93 E1 00 2C */	stw r31, 0x2c(r1)
/* 8010907C 0010459C  93 C1 00 28 */	stw r30, 0x28(r1)
/* 80109080 001045A0  93 A1 00 24 */	stw r29, 0x24(r1)
/* 80109084 001045A4  7C 9D 23 78 */	mr r29, r4
/* 80109088 001045A8  80 C3 00 04 */	lwz r6, 4(r3)
/* 8010908C 001045AC  83 C3 00 08 */	lwz r30, 8(r3)
/* 80109090 001045B0  7F A3 EB 78 */	mr r3, r29
/* 80109094 001045B4  7C 05 33 96 */	divwu r0, r5, r6
/* 80109098 001045B8  7C 00 31 D6 */	mullw r0, r0, r6
/* 8010909C 001045BC  7C 00 28 50 */	subf r0, r0, r5
/* 801090A0 001045C0  54 1F 18 38 */	slwi r31, r0, 3
/* 801090A4 001045C4  7D 3E F8 2E */	lwzx r9, r30, r31
/* 801090A8 001045C8  88 C9 00 21 */	lbz r6, 0x21(r9)
/* 801090AC 001045CC  88 09 00 22 */	lbz r0, 0x22(r9)
/* 801090B0 001045D0  80 89 00 08 */	lwz r4, 8(r9)
/* 801090B4 001045D4  7C A6 00 50 */	subf r5, r6, r0
/* 801090B8 001045D8  7C 00 30 50 */	subf r0, r0, r6
/* 801090BC 001045DC  7C A0 03 78 */	or r0, r5, r0
/* 801090C0 001045E0  A0 A9 00 02 */	lhz r5, 2(r9)
/* 801090C4 001045E4  A0 C9 00 00 */	lhz r6, 0(r9)
/* 801090C8 001045E8  54 0A 0F FE */	srwi r10, r0, 0x1f
/* 801090CC 001045EC  80 E9 00 04 */	lwz r7, 4(r9)
/* 801090D0 001045F0  81 09 00 0C */	lwz r8, 0xc(r9)
/* 801090D4 001045F4  81 29 00 10 */	lwz r9, 0x10(r9)
/* 801090D8 001045F8  4B F9 E7 FD */	bl GXInitTexObj
/* 801090DC 001045FC  7C FE F8 2E */	lwzx r7, r30, r31
/* 801090E0 00104600  3C A0 43 30 */	lis r5, 0x4330
/* 801090E4 00104604  90 A1 00 08 */	stw r5, 8(r1)
/* 801090E8 00104608  7F A3 EB 78 */	mr r3, r29
/* 801090EC 0010460C  88 87 00 21 */	lbz r4, 0x21(r7)
/* 801090F0 00104610  38 C0 00 00 */	li r6, 0
/* 801090F4 00104614  88 07 00 22 */	lbz r0, 0x22(r7)
/* 801090F8 00104618  39 00 00 00 */	li r8, 0
/* 801090FC 0010461C  90 81 00 0C */	stw r4, 0xc(r1)
/* 80109100 00104620  C8 42 88 90 */	lfd f2, lbl_80248090@sda21(r2)
/* 80109104 00104624  C8 01 00 08 */	lfd f0, 8(r1)
/* 80109108 00104628  90 A1 00 10 */	stw r5, 0x10(r1)
/* 8010910C 0010462C  EC 20 10 28 */	fsubs f1, f0, f2
/* 80109110 00104630  80 87 00 14 */	lwz r4, 0x14(r7)
/* 80109114 00104634  90 01 00 14 */	stw r0, 0x14(r1)
/* 80109118 00104638  80 A7 00 18 */	lwz r5, 0x18(r7)
/* 8010911C 0010463C  C8 01 00 10 */	lfd f0, 0x10(r1)
/* 80109120 00104640  C0 67 00 1C */	lfs f3, 0x1c(r7)
/* 80109124 00104644  EC 40 10 28 */	fsubs f2, f0, f2
/* 80109128 00104648  88 E7 00 20 */	lbz r7, 0x20(r7)
/* 8010912C 0010464C  4B F9 E9 FD */	bl GXInitTexObjLOD
/* 80109130 00104650  80 01 00 34 */	lwz r0, 0x34(r1)
/* 80109134 00104654  83 E1 00 2C */	lwz r31, 0x2c(r1)
/* 80109138 00104658  83 C1 00 28 */	lwz r30, 0x28(r1)
/* 8010913C 0010465C  83 A1 00 24 */	lwz r29, 0x24(r1)
/* 80109140 00104660  7C 08 03 A6 */	mtlr r0
/* 80109144 00104664  38 21 00 30 */	addi r1, r1, 0x30
/* 80109148 00104668  4E 80 00 20 */	blr

